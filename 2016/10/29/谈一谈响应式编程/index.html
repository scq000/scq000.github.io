<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>谈一谈响应式编程 | Paolino</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">谈一谈响应式编程</h1><a id="logo" href="/.">Paolino</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">谈一谈响应式编程</h1><div class="post-meta">Oct 29, 2016</div><div class="post-content"><p>随着前端框架react,angular以及vue的流行，响应式编程也开始在前端领域得以广泛应用。因此，了解并且理解响应式编程有助于更好地学习这些框架，同时利用好响应式编程的相关工具，可以让编程更加轻松。</p>
<h1 id="什么是响应式编程"><a href="#什么是响应式编程" class="headerlink" title="什么是响应式编程"></a>什么是响应式编程</h1><p>和平常经常听说的面向对象编程和函数式编程一样，响应式编程(Reactive Programming)就是一个编程范式，但是与其他编程范式不同的是它是基于数据流和变化传播的。我们经常在程序中这样写</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">A</span> = B + C</span><br></pre></td></tr></table></figure>
<p><code>A</code>被赋值为<code>B</code>和<code>C</code>的值。这时，如果我们改变<code>B</code>的值，<code>A</code>的值并不会随之改变。而如果我们运用一种机制，当<code>B</code>或者<code>C</code>的值发现变化的时候，<code>A</code>的值也随之改变，这样就实现了”响应式“。</p>
<p>而响应式编程的提出，其目的就是简化类似的操作，因此它在用户界面编程领域以及基于实时系统的动画方面都有广泛的应用。另一方面，在处理嵌套回调的异步事件，复杂的列表过滤和变换的时候也都有良好的表现。</p>
<h1 id="函数响应式编程"><a href="#函数响应式编程" class="headerlink" title="函数响应式编程"></a>函数响应式编程</h1><blockquote>
<p>而主要利用函数式编程(Functional Programming)的思想和方法(函数、高阶函数)来支持Reactive Programming就是所谓的<a href="http://en.wikipedia.org/wiki/Functional_reactive_programming" target="_blank" rel="noopener">Functional Reactive Programming</a>，简称FRP。</p>
</blockquote>
<p>FPR 将输入分为两个基础的部分：行为(behavior)和事件(events) 。这两个基本元素在函数响应式编程中都是第一类（first-class）值。 其中行为是随时间连续变化的数据，而事件则是基于离散的时间序列 。例如：在我们操作网页的时候，会触发很多的事件，包括点击，拖动，按键事件等。这些事件都是不连续的。对事件求值是没有意义的，所有我们一般要通过<code>fromEvent</code>，<code>buffer</code>等将其变成连续的行为来做进一步处理。与RP相比，FRP更偏重于底层。由于采用了函数式编程范式，FRP也自然而然带有其特点。这其中包括了不可变性，没有副作用以及通过组合函数来构建程序等特点。</p>
<h1 id="应用范围"><a href="#应用范围" class="headerlink" title="应用范围"></a>应用范围</h1><ol>
<li>多线程，时间处理，阻塞等场景</li>
<li>ajax，websocket和数据加载</li>
<li>失败处理</li>
<li>DOM事件和动画</li>
</ol>
<h1 id="观察者模式和迭代器模式"><a href="#观察者模式和迭代器模式" class="headerlink" title="观察者模式和迭代器模式"></a>观察者模式和迭代器模式</h1><p>在这里简单介绍一下观察者模式和迭代器模式，便于对后续介绍的概念有所了解。</p>
<h2 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h2><blockquote>
<p>观察者模式(Observer Pattern)：定义了对象间的一种一对多的依赖关系，当一个对象状态发生改变时，其相关依赖对象皆得到通知并被自动更新。观察者模式又叫做发布-订阅（Publish/Subscribe）模式、模型-视图（Model/View）模式、源-监听器（Source/Listener）模式或从属者（Dependents）模式。</p>
</blockquote>
<p>观察者模式在事件处理中应用特别广泛，也是MVC架构模式的核心。我们来写一个简单的应用，试一试：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(index) &#123;</span><br><span class="line">    <span class="keyword">this</span>.index = index;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  say() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`我是第<span class="subst">$&#123;<span class="keyword">this</span>.index&#125;</span>个用户😁`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  update() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'observer : 我开始说话了'</span>);</span><br><span class="line">    <span class="keyword">this</span>.say();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 被监听者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.observers = [];</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  addObserver(observer) &#123;</span><br><span class="line">    <span class="keyword">this</span>.observers.push(observer);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  removeObserverByIndex(index) &#123;</span><br><span class="line">    <span class="keyword">this</span>.observers.splice(index,<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  notify() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Observable : 开始通知所有监听者'</span>);</span><br><span class="line">    <span class="keyword">this</span>.observers.forEach(<span class="function"><span class="params">x</span> =&gt;</span> x.update());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//客户端代码，注册监听</span></span><br><span class="line"><span class="keyword">const</span> observer1 = <span class="keyword">new</span> Observer(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">const</span> observer2 = <span class="keyword">new</span> Observer(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">const</span> observable = <span class="keyword">new</span> Observable();</span><br><span class="line">observable.addObserver(observer1);</span><br><span class="line">observable.addObserver(observer2);</span><br><span class="line"><span class="comment">//通知所有监听者</span></span><br><span class="line">observable.notify();</span><br></pre></td></tr></table></figure>
<p> 执行结果如下：</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"Observable : 开始通知所有监听者"</span></span><br><span class="line"><span class="string">"observer : 我开始说话了"</span></span><br><span class="line"><span class="string">"我是第1个用户😁"</span></span><br><span class="line"><span class="string">"observer : 我开始说话了"</span></span><br><span class="line"><span class="string">"我是第2个用户😁"</span></span><br></pre></td></tr></table></figure>
<p>在观察者模式中，可以分为两种模式，push和pull:</p>
<p>1.push“推模式“，就是被监听者将消息推送出去，进而触发监听者的相应事件。如上面的事例代码就是采用这种方式，响应式编程一般采用这种模式。</p>
<p>2.pull”拉模式”，就是监听者主动从被监听者处获取数据。</p>
<h2 id="迭代器模式"><a href="#迭代器模式" class="headerlink" title="迭代器模式"></a>迭代器模式</h2><blockquote>
<p>提供一种方法顺序访问一个聚合对象中的各个元素，而又不暴露内部的表示。</p>
</blockquote>
<p>迭代器模式常用的场合是在遍历集合，增删改查的时候。如今，很多的高级语言都已经将其作为自身的语言特性，如python,java，es6等都有其实现。我们可以使用es5的语法简单实现一下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getIterator</span>(<span class="params">array</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> nextIndex = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">       next: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">           <span class="keyword">return</span> nextIndex &lt; array.length ?</span><br><span class="line">               &#123;<span class="attr">value</span>: array[nextIndex++], <span class="attr">done</span>: <span class="literal">false</span>&#125; :</span><br><span class="line">               &#123;<span class="attr">done</span>: <span class="literal">true</span>&#125;;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> iterator = getIterator([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br><span class="line">iterator.next().value; <span class="comment">// 1</span></span><br><span class="line">iterator.next().value; <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>以上的代码利用了javscript语法的闭包特性，返回了一个带状态的对象，通过调用<code>next</code>方法来获取集合中的下一个值。这和函数式编程中部分求值的特点是一样的。这个模式很简单，我们利用它就可以不再需要手动遍历获取集合中的数据了。</p>
<h1 id="RX-Reactive-Extension"><a href="#RX-Reactive-Extension" class="headerlink" title="RX(Reactive Extension)"></a>RX(Reactive Extension)</h1><p>Reactive Extension 这个概念最早是出现在微软的.NET社区中的，而目前也越来越多的语言实现了自己的RX，如java,javascript,ruby等。</p>
<p>微软官方的解释是这样的：</p>
<blockquote>
<p> <strong>Reactive Extensions</strong> (<strong>Rx</strong>) is a library for composing asynchronous and event-based programs using observable sequences and LINQ-style query operators.</p>
</blockquote>
<p>简单地来说就是利用<code>Observable</code>和<code>LINQ</code>风格的基于事件驱动的编程扩展库。它是响应式编程的一种实现，用于解决异步事件流的一种解决方案。通俗点解释，就是利用它可以很好地控制事件流的异步操作，将事件的发生和对事件的响应进行解耦。可以让开发者不再关心复杂的线程处理，锁等并发相关问题。</p>
<h2 id="RxJs"><a href="#RxJs" class="headerlink" title="RxJs"></a>RxJs</h2><p><a href="https://github.com/Reactive-Extensions/RxJS" target="_blank" rel="noopener">RxJS</a>是用javascript实现的一个RX类库， 官方说明里指出<code>RxJS = Observables + Operators + Schedulers</code>。其中<code>Observables</code>用于生产消息，而<code>Subscriber</code>则用于消费消息，这和生产者和消费者的概念有点类似。</p>
<p><code>Obversables</code>其实是一组事件流，比如你在键盘上输入”hello”这五个字母，你就有了”h - e - l - l -o”十个<code>keydown + keyup</code>事件组成的一组序列，这就称为<code>Obversables</code>，但是它是不可更改的。如果你只想要过滤出<code>keydown</code>事件怎么做呢？这时候你就需要利用<code>Operators</code>，在响应式编程概念里可以利用其组合出新的行为和事件。在这里，你可以用它用来操作这个不可变的<code>Obversable</code>从而生成你想要的结果，同时，可以采用多个链式调用来进行更加复杂的操作，如：</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obversables.filter(<span class="function"><span class="params">(event)</span> =&gt;</span> &#123;<span class="keyword">return</span> event === <span class="string">'keydown'</span> &#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Observable"><a href="#Observable" class="headerlink" title="Observable"></a>Observable</h2><p>Observable 实际上是应用了观察者模式和迭代器模式的事件或者说消息序列。在RxJs中提供了多个API来将生成<code>Observable</code>对象，如基本的create,of, fromEvent等。</p>
<p><code>Observable</code>可以被订阅(subscribe)，随后会将数据push给所有订阅者(subscribers)。</p>
<p>你可能在处理异步操作的时候，会应用到<code>Promise</code>这个技术。那么<code>Observable</code>和<code>Promise</code>相比，又有什么区别呢？</p>
<p>首先，Observable是不可变的，这也是函数式编程的思想。你每次需要获取新的序列的时候，都需要利用函数操作对其做变换，这也避免了无意中修改数据造成的Bug。其次，我们知道Promise对象一旦生成并触发后，是不可以取消的，而Observable是可以，这也提供了一些灵活性。同时，当你需要共享变量的时候，<code>Observable</code>是可以组合使用的。最后，还有一个特性是<code>Promise</code>每次只能返回一个值，而<code>Observable</code>可以返回多值。</p>
<h2 id="Observer"><a href="#Observer" class="headerlink" title="Observer"></a>Observer</h2><blockquote>
<p> <strong>Observer:</strong> is a collection of callbacks that knows how to listen to values delivered by the Observable.</p>
</blockquote>
<p><code>Observer</code>就是一组回调函数的集合，包括next, error, complete三个，它的值是<code>Observable</code>传进来的，然后在监听的时候来触发这些函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = Rx.Observable.create(<span class="function"><span class="keyword">function</span> (<span class="params">observer</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Hello'</span>);</span><br><span class="line">  observer.next(<span class="number">42</span>);</span><br><span class="line">  observer.next(<span class="number">100</span>);</span><br><span class="line">  observer.next(<span class="number">200</span>);</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    observer.next(<span class="number">300</span>); <span class="comment">// happens asynchronously</span></span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'before'</span>);</span><br><span class="line">foo.subscribe(<span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'after'</span>);</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line"><span class="string">"before"</span></span><br><span class="line"><span class="string">"Hello"</span></span><br><span class="line"><span class="number">42</span></span><br><span class="line"><span class="number">100</span></span><br><span class="line"><span class="number">200</span></span><br><span class="line"><span class="string">"after"</span></span><br><span class="line"><span class="number">300</span></span><br></pre></td></tr></table></figure>
<h2 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h2><p>由于<code>Observables</code>是不可变的，因此要根据原生的数据结构生成新的数据结构，必须要借助强大的函数组合来达到效果。<code>Operator</code>就是这样的一个工具箱。它不仅仅提供了我们常见的<code>map</code>,<code>filter</code>,<code>reduce</code>操作，也提供了如连接，条件判断，转换，聚合，操作时间等方法。</p>
<p>在Javascript原生的数组操作中，也经常可以看到<code>map</code>,<code>filter</code>,<code>reduce</code>等函数的身影，如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = [<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'hello'</span>, <span class="string">'world'</span>];</span><br><span class="line"><span class="keyword">var</span> result = source.map(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">parseInt</span>(x)).filter(<span class="function"><span class="params">x</span> =&gt;</span> !<span class="built_in">isNaN</span>(x));</span><br></pre></td></tr></table></figure>
<p>而RxJs提供的Operator和对数组操作的又有什么区别呢？Operator工作和数组相比较而言，数组每次操作会直接处理整个数组，但是Operator是一个迭代器，它会在处理完一个值后才转去处理下一个值。</p>
<h3 id="安装和使用"><a href="#安装和使用" class="headerlink" title="安装和使用"></a>安装和使用</h3><p>现在官方提供的RxJs有两个仓库，<a href="https://github.com/ReactiveX/RxJS" target="_blank" rel="noopener">RxJs5</a>以及<a href="https://github.com/Reactive-Extensions/RxJS" target="_blank" rel="noopener">RxJS</a>,你可以自己选择</p>
<p>安装rxjs用</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> rx</span><br></pre></td></tr></table></figure>
<p>而安装rxjs5就用</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> rxjs</span><br></pre></td></tr></table></figure>
<p>然后导入项目中应用就可以了。</p>
<p><strong>如果你嫌麻烦的话，我在github上创建了新的初始项目，可以直接上手应用RxJS,仓库地址<a href="https://github.com/scq000/rxjs-quick-starter" target="_blank" rel="noopener">https://github.com/scq000/rxjs-quick-starter</a>。</strong>用来练手写个小Demo还是很方便的。</p>
<h1 id="动手写一写"><a href="#动手写一写" class="headerlink" title="动手写一写"></a>动手写一写</h1><p>下面我们来写一个小的Demo。任务是通过查询<a href="https://developer.github.com/v3/" target="_blank" rel="noopener">GitHub的API</a>， 获取用户列表,然后当点击特定用户名的时候，获取这个用户的详细信息。基于Github官方的提供的两个API：</p>
<ol>
<li><a href="https://api.github.com/users" target="_blank" rel="noopener">https://api.github.com/users</a></li>
<li><a href="https://api.github.com/users/username" target="_blank" rel="noopener">https://api.github.com/users/username</a></li>
</ol>
<p>其实，利用原生的Javascript我们也能很好地实现这样的需求。不过我们通常会依赖前一次的回调状态，因此它不适用于模块化或者修改要传递给下一个回调的数据）。当我们要回调的层数比较多的时候，我们就陷入了<a href="http://callbackhell.com/" target="_blank" rel="noopener">“回调地狱”</a>中去了。现在就让我们看看RxJs怎么实现这样一个需求吧。</p>
<ol>
<li><p>先创建HTML页面结构：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"getAllBtn"</span>&gt;</span>Get All Users<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">onsubmit</span>=<span class="string">"return false;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"search-input"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"search"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"user-lists"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"user-info"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>写JS代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入依赖</span></span><br><span class="line"><span class="keyword">const</span> $ = <span class="built_in">require</span>(<span class="string">'jquery'</span>);</span><br><span class="line"><span class="keyword">const</span> Rx = <span class="built_in">require</span>(<span class="string">'rxjs/Rx'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取页面元素</span></span><br><span class="line"><span class="keyword">const</span> getAllBtn = $(<span class="string">'#getAllBtn'</span>);</span><br><span class="line"><span class="keyword">const</span> searchInput = $(<span class="string">'#search-input'</span>);</span><br><span class="line"><span class="keyword">let</span> keyword = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义事件流</span></span><br><span class="line"><span class="keyword">const</span> clickEventStream = Rx.Observable.fromEvent(getAllBtn, <span class="string">'click'</span>);</span><br><span class="line"><span class="keyword">const</span> inputEventStream = Rx.Observable.fromEvent(searchInput, <span class="string">'keyup'</span>).filter(<span class="function"><span class="params">event</span> =&gt;</span> event.keyCode !== <span class="number">13</span>);</span><br><span class="line"><span class="keyword">const</span> clickUserItemStream = Rx.Observable.fromEvent($(<span class="string">'#user-lists'</span>), <span class="string">'click'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//将用户触发的事件流转换成API请求流</span></span><br><span class="line"><span class="keyword">const</span> getUserListStream = clickEventStream.flatMap(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> Rx.Observable.fromPromise($.getJSON(<span class="string">'https://api.github.com/users'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> filterUserStream = inputEventStream.flatMap(<span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> Rx.Observable.fromPromise($.getJSON(<span class="string">'https://api.github.com/users'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getUserInformation = clickUserItemStream.flatMap(<span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(event.target.innerText);</span><br><span class="line">  <span class="keyword">return</span> Rx.Observable.fromPromise($.getJSON(<span class="string">'https://api.github.com/users/'</span> + event.target.innerText));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//当响应到达时触发</span></span><br><span class="line">getUserInformation.subscribe(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(user);</span><br><span class="line">  renderUserInfo(user);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">filterUserStream.subscribe(<span class="function"><span class="params">users</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(users);</span><br><span class="line">  renderUserLists(users.filter(<span class="function"><span class="params">user</span> =&gt;</span> user.login.includes(keyword)));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">clickEventStream.subscribe(</span><br><span class="line">  value =&gt; <span class="built_in">console</span>.log(<span class="string">'GetUsers btn click!'</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">inputEventStream.subscribe(<span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(searchInput.val());</span><br><span class="line">  keyword = searchInput.val();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">clickUserItemStream.subscribe(<span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(event.target);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">getUserListStream.catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  Rx.Observable.of(err); <span class="comment">//使用catch函数避免错误被中断</span></span><br><span class="line">&#125;).subscribe(<span class="function"><span class="params">users</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(users);</span><br><span class="line">  renderUserLists(users)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//将数据渲染到DOM元素上</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderUserLists</span>(<span class="params">users</span>) </span>&#123;</span><br><span class="line">  $(<span class="string">'#user-lists'</span>).html(<span class="string">''</span>);</span><br><span class="line">  users.forEach(<span class="function">(<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">    $(<span class="string">'#user-lists'</span>).append(<span class="string">`&lt;li&gt;<span class="subst">$&#123;user.login&#125;</span>&lt;/li&gt;`</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderUserInfo</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  $(<span class="string">'#user-info'</span>).html(<span class="string">''</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> user) &#123;</span><br><span class="line">    $(<span class="string">'#user-info'</span>).append(<span class="string">`&lt;div&gt;<span class="subst">$&#123;key&#125;</span> ---&gt; <span class="subst">$&#123;user[key]&#125;</span>&lt;/div&gt;`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>代码已经放在<a href="https://github.com/scq000/rxjs-demo" target="_blank" rel="noopener">Github</a>，如果你感兴趣的话，可以<code>clone</code>下来跑跑看。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>响应式编程的思想比较不好理解，我在学习过程中，也查阅了很多的资料，只能算是刚刚入门。所以，这篇文章也算是对整个学习过程的一次总结吧。</p>
<h1 id="Read-More"><a href="#Read-More" class="headerlink" title="Read More"></a><em>Read More</em></h1><p><a href="https://en.wikipedia.org/wiki/Reactive_programming" target="_blank" rel="noopener">React Programming</a><br><a href="https://codewords.recurse.com/issues/two/an-introduction-to-reactive-programming" target="_blank" rel="noopener">An introduction to reactive programming</a><br><a href="http://www.slideshare.net/edwardamsden/introduction-to-functional-reactive-programming" target="_blank" rel="noopener">Slidershare: introduction to functional reactive programming</a><br><a href="http://haskell.cs.yale.edu/wp-content/uploads/2011/02/frp-1st.pdf" target="_blank" rel="noopener">Functional Reactive Programming from First Principles</a><br><a href="https://www.cs.rit.edu/~mtf/student-resources/20103_amsden_istudy.pdf" target="_blank" rel="noopener"> A survey of functional reactive programming</a></p>
<p><a href="http://www.ituring.com.cn/article/261155" target="_blank" rel="noopener">响应式编程一览</a></p>
<p><a href="http://www.zhidao91.com/csharp-list16/" target="_blank" rel="noopener">C#设计模式系列(16)-迭代器模式</a><br><a href="http://reactivex.io/learnrx/" target="_blank" rel="noopener">学习教程</a><br><a href="http://xgrommx.github.io/rx-book/index.html" target="_blank" rel="noopener">RxJs GitBook</a><br><a href="http://reactivex.io/rxjs/manual/overview.html" target="_blank" rel="noopener">RxJs官方文档</a><br><a href="https://egghead.io/lessons/rxjs-reactive-programming-what-is-rxjs?course=introduction-to-reactive-programming" target="_blank" rel="noopener">Introduction to reactive programming 视频</a></p>
</div><div class="tags"><a href="/tags/javascript/">javascript</a></div><div class="post-nav"><a class="pre" href="/2016/11/05/前端的异步解决方案之Promise和Await-Async/">前端的异步解决方案之Promise和Await/Async</a><a class="next" href="/2016/10/29/python爬虫小结/">python爬虫小结</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/性能优化/" style="font-size: 15px;">性能优化</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/react/" style="font-size: 15px;">react</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/vuex/" style="font-size: 15px;">vuex</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/生活/" style="font-size: 15px;">生活</a> <a href="/tags/技术/" style="font-size: 15px;">技术</a> <a href="/tags/html/" style="font-size: 15px;">html</a> <a href="/tags/正则/" style="font-size: 15px;">正则</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/redux/" style="font-size: 15px;">redux</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/flexbox/" style="font-size: 15px;">flexbox</a> <a href="/tags/es6/" style="font-size: 15px;">es6</a> <a href="/tags/异步/" style="font-size: 15px;">异步</a> <a href="/tags/函数式编程/" style="font-size: 15px;">函数式编程</a> <a href="/tags/css-grid/" style="font-size: 15px;">css,grid</a> <a href="/tags/正则表达式/" style="font-size: 15px;">正则表达式</a> <a href="/tags/跨域/" style="font-size: 15px;">跨域</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/08/30/神奇的Lambda表达式——函数式编程必学/">神奇的Lambda表达式——函数式编程必学</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/12/ES2019新特性预览/">ES2019新特性预览</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/07/17/CSS-Grid-网格布局全攻略/">CSS Grid 网格布局全攻略</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/16/正则表达式不要背/">正则表达式不要背</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/26/理解Redux中间件/">理解Redux中间件</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/11/React中的五种组件形式/">React中的五种组件形式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/24/浅谈性能优化之Tree-Shaking/">浅谈性能优化之Tree Shaking</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/08/那些年，那些跨域问题/">那些年，那些跨域问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/30/响应式图片的处理/">响应式图片的处理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/09/ES6语言特性的总结-3/">ES6语言特性的总结(3)</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">Paolino.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>